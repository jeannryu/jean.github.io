---
layout: post
title:  "Cloudflare Free Plan으로 웹서버 보호하기"
ref:  20210405a
date:   2021-04-05 00:00:00 +0800
categories: cloudflare security
tags: cloudflare freeplan
lang: ko
---

Cloudflare Enterprise Plan을 홍보하고 판매하는 것이 저의 업무이기는 합니다만, 저희 회사 무료 플랜도 잘 쓰면 참 좋습니다. 특히 비영리, 소규모 사이트가 대규모 트래픽이나 DDoS 공격에 노출되어 있을 때 잘 사용하면 정말 괜찮답니다. 아시는 분들은 (이미 잘 아셔서) 무료 요금제 등록하시고 intensive 하게 이용하고 계시지만, 좋은 비영리 프로젝트에 Cloudflare를 선택해 주셨는데 잘 활용을 못하시고 공격을 받으실까봐 `Free Plan에서도 설정하실 수 있는` 방어 체크리스트를 정리해 봅니다.

1. 웹서버 주소가 인터넷에 노출되었는지 확인하고 노출되었을 시 바꾸기
 - 방어대상 도메인은 전부 proxy on
2. 웹서버에 포트스캔을 돌려 보고 웹서버에서 ANY로 오픈된 포트가 없도록 바꾸기
3. 웹서버에서 Cloudflare IP만 허용하고 전체 막기
4. 정적인 페이지의 경우 웹서버 트래픽을 소모하지 않도록 공격적으로 + 오래 캐시하기
 - 콘텐츠 업데이트가 있었을 경우 Cache Purge 기능을 이용하여 적용하기
5. 실시간으로 디도스 공격이 일어나는 것으로 의심되거나 트래픽이 몰릴 경우 대책 준비해 두기
 - "한국만 빼고 전체 Captcha" 등의 방화벽 규칙 마련
 - "보안 수준" 높이기 (평시 High, 비상시 I'm Under Attack Mode)
 - admin 외에는 접근 불가해야 하는 페이지 - 방화벽 규칙
6. SSL 개선하기
 - 자동 SSL 사용
 - 오리진 인증서 이용하여 모든 end-to-end 구간 암호화하고 TLS 모드 full 이상 사용
7. 성능 개선하기
 - 자동 최소화 3개 규칙 이용하기
 - Brotli, 로켓 로더, 0-RTT 연결 재개, TLS 1.3 이용하기
8. 기타 유의 사항
 - IP access rule 주의해서 이용하기

실시간 트래픽량과 공격방어현황을 모니터링한다든지, 웹서버 헬스체크를 설정한다든지, 개별기기에 대한 리퀘스트 가능 횟수를 제한하거나 대기실을 만든다든지 등등 고급 기능이 되면 아무래도 윗단계 플랜이 필요해지는 것은 어쩔 수 없습니다. 특히 웹사이트에서 현금이 오고가는(!) 이커머스나 금융쪽 기관 고객이신 경우에는 무료 플랜은 절대 추천하지 않습니다. (개인적으로는 Pro나 Business 플랜도 추천하지 않습니다) 기능적인 문제보다도 SLA나 담당 지원팀 등 기업에서 필요한 지원 체계가 무료 플랜 고객분들께는 현실적으로 할당되기 어려워서 그렇습니다.

그러나, 트래픽/공격이 몰리지만 방어예산이 부족한 개인/비영리 프로젝트인 경우 Cloudflare 무료 요금제의 도움을 받으시면 정말 좋습니다. 무료 요금제는 지원 엔지니어가 없기 때문에 설정하시는 담당자께서 혹여 관련 지식이 부족하시면 안타깝게도 설정 실수로 디도스를 그대로 받으시기도 합니다... 그러나 실제로는, 잘 설정하시면 정말 효과적이랍니다. [Cloudflare DDoS 솔루션은 업계 최고로 글로벌하게 인정받고 있는 서비스입니다.](https://www.cloudflare.com/forrester-wave-ddos-mitigation-2021/)

이런 서비스의 국내 버전도 있어서 적어 봅니다. 제 전 직장이기도 한 한국인터넷진흥원에서도 이런 훌륭한 일을 합니다. [국내 중소기업 무료지원 - DDoS 사이버대피소 서비스](https://www.krcert.or.kr/webprotect/cyberShelters/cyberShelters.do) 웹사이트를 확인해 보세요. 이 서비스는 신청자격이 되는 경우 기술지원도 받으실 수 있습니다. 디도스 걱정할 이유가 없네요...!