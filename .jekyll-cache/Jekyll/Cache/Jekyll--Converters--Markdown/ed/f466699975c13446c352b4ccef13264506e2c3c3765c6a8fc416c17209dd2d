I"í<p>Cloudflare Workersë¥¼ ì‚¬ìš©í•˜ë©´ ì½”ë“œ ìŠ¤ë‹ˆí«ì„ ì—£ì§€ ë°ì´í„° ì„¼í„°ì—ì„œ ëŒë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì˜ˆì œì—ì„œëŠ” ë¦¬í€˜ìŠ¤íŠ¸ í—¤ë”ì—ì„œ êµ­ê°€ ì •ë³´ë¥¼ ì½ì–´ ë¸”ë¡œê·¸ì˜ í•´ë‹¹í•˜ëŠ” ì–¸ì–´ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜í•©ë‹ˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">addEventListener</span><span class="p">(</span><span class="s1">'fetch'</span><span class="p">,</span> <span class="n">event</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="n">event</span><span class="p">.</span><span class="nf">respondWith</span><span class="p">(</span><span class="n">fetchAndApply</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="nf">request</span><span class="p">))</span>
<span class="p">})</span>

<span class="n">async</span> <span class="n">function</span> <span class="n">fetchAndApply</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="p">{</span>

  <span class="n">const</span> <span class="n">clientCountry</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="nf">headers</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s1">'CF-IPCountry'</span><span class="p">)</span>
  <span class="n">let</span> <span class="n">colo</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="nf">cf</span><span class="p">.</span><span class="nf">colo</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">clientCountry</span> <span class="o">===</span> <span class="s1">'KR'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">new</span> <span class="no">Response</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="p">{</span>
        <span class="ss">status: </span><span class="mi">301</span><span class="p">,</span>
        <span class="ss">headers: </span><span class="p">{</span> <span class="s1">'Location'</span><span class="p">:</span> <span class="s1">'https://blog.jeann.net/kr.html'</span><span class="p">}</span>
      <span class="p">}</span>
    <span class="p">)}</span>

  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">clientCountry</span> <span class="o">===</span> <span class="s1">'FR'</span> <span class="o">|</span> <span class="n">colo</span> <span class="o">===</span> <span class="s1">'CDG'</span><span class="p">)</span> <span class="p">{</span> 
       <span class="k">return</span> <span class="n">new</span> <span class="no">Response</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="p">{</span>
        <span class="ss">status: </span><span class="mi">301</span><span class="p">,</span>
        <span class="ss">headers: </span><span class="p">{</span> <span class="s1">'Location'</span><span class="p">:</span> <span class="s1">'https://blog.jeann.net/fr.html'</span><span class="p">}</span>
      <span class="p">}</span>
    <span class="p">)}</span>

  <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">fetch</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>ì´ ì½”ë“œëŠ” êµ­ê°€ ì •ë³´ (CloudflareëŠ” 2020ë…„ ê¸°ì¤€ ì´ë¥¼ ìœ„í•´ Maxmindë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤) ì™€ ì—£ì§€ ë°ì´í„°ì„¼í„° (colo) ì •ë³´ë¥¼ ì½ìŠµë‹ˆë‹¤. êµ­ê°€ ì •ë³´ê°€ í•œêµ­ì¼ ê²½ìš° ë¦¬í€˜ìŠ¤íŠ¸ëŠ” <code class="language-plaintext highlighter-rouge">/kr.html</code> ë¡œ ë¦¬ë””ë ‰ì…˜ë©ë‹ˆë‹¤. êµ­ê°€ ì •ë³´ê°€ í”„ë‘ìŠ¤ì´ê±°ë‚˜ Cloudflareì˜ íŒŒë¦¬ ë°ì´í„° ì„¼í„° <code class="language-plaintext highlighter-rouge">CDG</code>ì— íˆíŠ¸í•œ ê²½ìš° ë¦¬í€˜ìŠ¤íŠ¸ëŠ” <code class="language-plaintext highlighter-rouge">/fr.html</code>ë¡œ ë¦¬ë””ë ‰ì…˜ë©ë‹ˆë‹¤. í•´ë‹¹ ì—†ì„ ê²½ìš° root path(ì˜ë¬¸ í˜ì´ì§€)ë¡œ ì‘ë‹µí•©ë‹ˆë‹¤.</p>

<p>ì´ ìŠ¤ë‹ˆí«ì€ ê¸°ë³¸ì ì¸ ì¡°ê±´ë¶€ ë¦¬ë””ë ‰ì…˜ì…ë‹ˆë‹¤ë§Œ ë°©ë¬¸ìê°€ ì–¸ì–´ì •ë³´ë¥¼ ì§ì ‘ ì„ íƒí•˜ì§€ ì•Šê³ ë„ ê°™ì€ FQDN ë‚´ì—ì„œ ì»¨í…ì¸ ë¥¼ ë¡œì»¬ë¼ì´ì¦ˆí•  ìˆ˜ ìˆì–´ ë„ë¦¬ ì‚¬ìš©ë©ë‹ˆë‹¤. êµ­ê°€ ì •ë³´ ëŒ€ì‹  ë¦¬í€˜ìŠ¤íŠ¸ í—¤ë”ì˜ <code class="language-plaintext highlighter-rouge">accept-language</code>ë¥¼ ì½ì–´ ë¸Œë¼ìš°ì €ê°€ ì„ í˜¸í•˜ëŠ” ì–¸ì–´ì…‹ì„ íŒë‹¨í•˜ì—¬ ë¦¬ë””ë ‰ì…˜ í•˜ëŠ” ê²ƒë„ ê³ ë ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <a href="https://blog.jeann.net/cloudflare/workers/2020/12/30/serve-lang-pages-with-workers.html">ì´ê³³ì—ì„œ ì½”ë“œ ìŠ¤ë‹ˆí«ì„ ì°¸ê³ í•˜ì„¸ìš”.</a></p>

<p>This is my personal template. You can feel free to re-use under your responsibility but please note Cloudflare Solutions Engineers do not:</p>

<ul>
  <li>Deploy code on customerâ€™s production environment</li>
  <li>Commit to any liability regarding the proper behaviour/logic of the code</li>
  <li>Provide code review of customerâ€™s scripts</li>
</ul>
:ET